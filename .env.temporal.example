# ============================================
# TEMPORAL WORKFLOW ORCHESTRATION CONFIGURATION
# ============================================
# Copy this file to .env and update with your values
# For local development, these defaults work with docker-compose.temporal.yml

# ============================================
# TEMPORAL SERVER CONNECTION
# ============================================

# Temporal server address (host:port)
# Local: localhost:7233
# Production: temporal.production.com:7233
TEMPORAL_ADDRESS=localhost:7233

# Temporal namespace (logical isolation of workflows)
# Default namespace: "default"
# Production: Use separate namespaces per environment
TEMPORAL_NAMESPACE=default

# ============================================
# TEMPORAL CLIENT CONFIGURATION
# ============================================

# Client identity (for logging and monitoring)
TEMPORAL_CLIENT_IDENTITY=traf3li-backend

# Connection timeout (ms)
TEMPORAL_CONNECTION_TIMEOUT=30000

# ============================================
# TEMPORAL WORKER CONFIGURATION
# ============================================

# Default task queue for workflows
# Best practice: Use specific task queues per workflow type
TEMPORAL_TASK_QUEUE=traf3li-default

# Task queue for invoice processing
TEMPORAL_INVOICE_QUEUE=traf3li-invoices

# Task queue for report generation
TEMPORAL_REPORT_QUEUE=traf3li-reports

# Task queue for data synchronization
TEMPORAL_SYNC_QUEUE=traf3li-sync

# Task queue for scheduled jobs
TEMPORAL_SCHEDULED_QUEUE=traf3li-scheduled

# Maximum concurrent activity executions per worker
# Adjust based on your system resources and activity I/O patterns
# CPU-bound activities: Lower value (10-20)
# I/O-bound activities: Higher value (50-100)
TEMPORAL_MAX_CONCURRENT_ACTIVITIES=10

# Maximum concurrent workflow task executions per worker
# Usually lower than activities since workflow tasks are CPU-intensive
TEMPORAL_MAX_CONCURRENT_WORKFLOWS=10

# Maximum cached workflows
# Higher values improve performance but use more memory
TEMPORAL_MAX_CACHED_WORKFLOWS=1000

# Worker shutdown grace period (seconds)
# Time allowed for in-progress activities to complete during shutdown
TEMPORAL_WORKER_SHUTDOWN_GRACE_PERIOD=30

# ============================================
# WORKFLOW EXECUTION CONFIGURATION
# ============================================

# Default workflow execution timeout (duration string)
# Maximum time a workflow can run before timing out
# Examples: "24h", "7d", "∞" (infinite)
TEMPORAL_WORKFLOW_EXECUTION_TIMEOUT=24h

# Default workflow run timeout (duration string)
# Maximum time a single workflow run can execute
# Use continueAsNew for longer executions
TEMPORAL_WORKFLOW_RUN_TIMEOUT=12h

# Default workflow task timeout (duration string)
# Maximum time for a workflow task to complete
TEMPORAL_WORKFLOW_TASK_TIMEOUT=10s

# ============================================
# ACTIVITY EXECUTION CONFIGURATION
# ============================================

# Default activity start-to-close timeout (duration string)
# Maximum time for activity execution from start to completion
TEMPORAL_ACTIVITY_START_TO_CLOSE_TIMEOUT=5m

# Default activity schedule-to-close timeout (duration string)
# Maximum time from scheduling to completion (including retries)
TEMPORAL_ACTIVITY_SCHEDULE_TO_CLOSE_TIMEOUT=10m

# Default activity schedule-to-start timeout (duration string)
# Maximum time for activity to wait in queue before starting
TEMPORAL_ACTIVITY_SCHEDULE_TO_START_TIMEOUT=1m

# Default activity heartbeat timeout (duration string)
# Maximum time between heartbeats for long-running activities
# Set to "0" to disable heartbeats
TEMPORAL_ACTIVITY_HEARTBEAT_TIMEOUT=30s

# ============================================
# RETRY POLICY CONFIGURATION
# ============================================

# Default retry policy for activities
# Initial retry interval (duration string)
TEMPORAL_RETRY_INITIAL_INTERVAL=1s

# Retry backoff coefficient (multiplier for each retry)
# Example: 2.0 means each retry interval is 2x the previous
TEMPORAL_RETRY_BACKOFF_COEFFICIENT=2.0

# Maximum retry interval (duration string)
# Cap on retry interval growth
TEMPORAL_RETRY_MAX_INTERVAL=1m

# Maximum retry attempts
# Set to 0 for unlimited retries
TEMPORAL_RETRY_MAX_ATTEMPTS=5

# Non-retryable error types (comma-separated)
# Activities that throw these errors won't be retried
TEMPORAL_RETRY_NON_RETRYABLE_ERRORS=ValidationError,AuthenticationError

# ============================================
# TEMPORAL LOGGING
# ============================================

# Temporal log level
# Options: error, warn, info, debug, trace
TEMPORAL_LOG_LEVEL=info

# Log workflow execution details
TEMPORAL_LOG_WORKFLOW_EXECUTIONS=true

# Log activity execution details
TEMPORAL_LOG_ACTIVITY_EXECUTIONS=true

# ============================================
# TEMPORAL TLS/SECURITY (PRODUCTION)
# ============================================

# Enable TLS for Temporal connection
TEMPORAL_TLS_ENABLED=false

# Path to client certificate (for mTLS)
TEMPORAL_TLS_CLIENT_CERT_PATH=/path/to/client.crt

# Path to client private key (for mTLS)
TEMPORAL_TLS_CLIENT_KEY_PATH=/path/to/client.key

# Path to server CA certificate
TEMPORAL_TLS_SERVER_CA_PATH=/path/to/ca.crt

# Server name override (for TLS)
TEMPORAL_TLS_SERVER_NAME=temporal.production.com

# ============================================
# TEMPORAL CLOUD (PRODUCTION)
# ============================================

# Temporal Cloud namespace (format: namespace.accountId)
# TEMPORAL_CLOUD_NAMESPACE=traf3li.a1b2c3

# Temporal Cloud API key
# TEMPORAL_CLOUD_API_KEY=your-api-key-here

# Temporal Cloud address
# TEMPORAL_CLOUD_ADDRESS=namespace.accountId.tmprl.cloud:7233

# ============================================
# DATA ENCRYPTION
# ============================================

# Enable payload encryption
TEMPORAL_PAYLOAD_ENCRYPTION_ENABLED=false

# Payload encryption key (base64 encoded)
# Generate with: openssl rand -base64 32
TEMPORAL_PAYLOAD_ENCRYPTION_KEY=

# ============================================
# MONITORING AND METRICS
# ============================================

# Enable Prometheus metrics
TEMPORAL_METRICS_ENABLED=false

# Prometheus metrics port
TEMPORAL_METRICS_PORT=9090

# Metrics prefix
TEMPORAL_METRICS_PREFIX=traf3li_temporal

# Enable OpenTelemetry tracing
TEMPORAL_TRACING_ENABLED=false

# OpenTelemetry collector endpoint
TEMPORAL_TRACING_ENDPOINT=http://localhost:4318

# ============================================
# WORKFLOW-SPECIFIC CONFIGURATION
# ============================================

# Invoice Processing Workflow
TEMPORAL_INVOICE_PROCESSING_TIMEOUT=30m
TEMPORAL_INVOICE_EMAIL_TIMEOUT=2m
TEMPORAL_INVOICE_PDF_GENERATION_TIMEOUT=5m

# Report Generation Workflow
TEMPORAL_REPORT_GENERATION_TIMEOUT=1h
TEMPORAL_REPORT_DATA_AGGREGATION_TIMEOUT=15m
TEMPORAL_REPORT_EXPORT_TIMEOUT=10m

# Data Sync Workflow
TEMPORAL_SYNC_BATCH_SIZE=100
TEMPORAL_SYNC_RETRY_ATTEMPTS=10
TEMPORAL_SYNC_TIMEOUT=2h

# Scheduled Jobs
TEMPORAL_BACKUP_SCHEDULE=0 2 * * *
TEMPORAL_REPORT_SCHEDULE=0 8 * * MON
TEMPORAL_CLEANUP_SCHEDULE=0 3 * * SUN

# ============================================
# FEATURE FLAGS
# ============================================

# Enable Temporal workflows (feature flag)
TEMPORAL_ENABLED=true

# Enable specific workflow types
TEMPORAL_INVOICE_WORKFLOWS_ENABLED=true
TEMPORAL_REPORT_WORKFLOWS_ENABLED=true
TEMPORAL_SYNC_WORKFLOWS_ENABLED=false
TEMPORAL_SCHEDULED_WORKFLOWS_ENABLED=true

# ============================================
# DEVELOPMENT/TESTING
# ============================================

# Use Temporal test server (in-memory)
TEMPORAL_USE_TEST_SERVER=false

# Enable workflow replay testing
TEMPORAL_ENABLE_REPLAY_TESTING=false

# Workflow history directory for replay tests
TEMPORAL_REPLAY_HISTORY_DIR=./temporal-histories

# ============================================
# DATABASE (FOR TEMPORAL SERVER - Docker)
# ============================================

# PostgreSQL connection for Temporal server
# These are used by docker-compose.temporal.yml
TEMPORAL_DB_HOST=temporal-postgresql
TEMPORAL_DB_PORT=5432
TEMPORAL_DB_NAME=temporal
TEMPORAL_DB_USER=temporal
TEMPORAL_DB_PASSWORD=temporal

# ============================================
# TEMPORAL UI (Docker)
# ============================================

# Temporal UI port (external)
TEMPORAL_UI_PORT=8088

# CORS origins for Temporal UI
TEMPORAL_UI_CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# ============================================
# ADVANCED CONFIGURATION
# ============================================

# Worker sticky schedule to start timeout
# Time a workflow task can stay in worker cache while workflow is idle
TEMPORAL_STICKY_SCHEDULE_TO_START_TIMEOUT=5s

# Enable eager workflow start
# Start workflow tasks immediately on the same worker
TEMPORAL_EAGER_WORKFLOW_START=true

# Data converter type
# Options: default, json, proto
TEMPORAL_DATA_CONVERTER=default

# Enable session workers (for file transfer, etc.)
TEMPORAL_ENABLE_SESSIONS=false

# Maximum concurrent sessions
TEMPORAL_MAX_CONCURRENT_SESSIONS=1000

# ============================================
# NOTES
# ============================================
#
# Duration String Format:
#   - Use Go duration format: "1s", "5m", "2h", "24h", "7d"
#   - Examples: "500ms", "1.5h", "∞" (infinite)
#
# Task Queues:
#   - Use separate task queues for different workflow types
#   - This enables independent scaling and deployment
#   - Example: traf3li-invoices, traf3li-reports, traf3li-sync
#
# Namespaces:
#   - Use separate namespaces for environments (dev, staging, prod)
#   - Namespaces provide isolation and independent retention policies
#
# Production Checklist:
#   ✓ Enable TLS (TEMPORAL_TLS_ENABLED=true)
#   ✓ Configure proper timeouts based on actual workflow durations
#   ✓ Set up monitoring and metrics
#   ✓ Configure appropriate retry policies
#   ✓ Use separate namespaces per environment
#   ✓ Enable payload encryption for sensitive data
#   ✓ Configure proper log levels (info or warn)
#   ✓ Set resource limits (max concurrent activities/workflows)
#   ✓ Plan for high availability (multiple workers)
#   ✓ Set up alerting for failed workflows
#
